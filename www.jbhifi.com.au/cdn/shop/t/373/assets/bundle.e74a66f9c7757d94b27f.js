"use strict";(globalThis.webpackChunkshopify_theme=globalThis.webpackChunkshopify_theme||[]).push([["7250"],{22776:function(e,t,r){r.d(t,{r:()=>g});var i=r(41622),n=r(70879),o=r(27337),l=r(11224),a=r(89101),c=r(80496),s=r(69868),u=r(54402),d=r(80732),p=r(44194),h=r(63784),f=r(21016),v=r(11438);let m=new f.Z,y="Joining JB Perks...",w=({children:e2})=>{var t2,r2;let{setThemeContext:f2,themeContext:w2,loadingMessage:g2,setLoadingMessage:b}=(0,l.ET)(),{data:{isFinished:_,isJustVerified:S,currentMobileNumber:E}}=(0,a.I4)(),{subscriptions:{[c.N.perks]:M},customer:k,customerLoading:C,customerError:R,linkedId:T}=(0,s.mz)(),{id:P,birthMonth:$}=k,x=(0,h.k6)(),A=()=>M?.isActive?w2?.birthMonthSelected?u.Rv.birthdayAdded:w2?.birthMonthExists?u.Rv.birthdayAlreadySaved:u.Rv.isAlreadyMember:M?.id?w2?.birthMonthSelected?u.Rv.isOldMemberWithBirthday:w2?.birthMonthExists?u.Rv.isOldMemberWithBirthdayAlreadySaved:u.Rv.isOldMember:w2?.birthMonthSelected?u.Rv.isNewMemberWithBirthday:u.Rv.isNewMember,F=e3=>{switch(e3){case d._.errorCodes.tooManyRequests:return"phoneVerifiedTooManyTimes";case d._.errorCodes.unauthorised:default:return"perksAuthError"}},V=(t2=(0,i._)(function*(){if(M==null||!M.isActive)return yield d._.createSubscription({subscriptionType:c.N.perks,customerId:P,linkedId:T,parentId:M?.id,sourceLocation:w2?.source,storeId:w2?.storeId})}),function(){return t2.apply(this,arguments)}),U=(r2=(0,i._)(function*(){let e3;if(R||M?.error)e3=F(M?.error);else{let r3=yield V();if(e3=r3?.error?F(r3?.statusCode):A(),(0,v.SJ)()){var t3;!r3?.error||r3?.error&&(!(r3==null||(t3=r3.data)===null||t3===void 0)&&t3.isActive)?(0,v.D0)({returningMember:M?.isActive,wasPreviousMember:!!M?.id}):(0,v.mE)(F(r3?.statusCode))}}(0,v.SJ)()||(w2?.receiptCode?m.redirectToAccount(w2.receiptCode,{alert:e3,gtmCategory:"eReceipts - JB Perks"}):window.location.href=`${window.location.origin}/account#/?alert=${e3}&gtmCategory=${encodeURIComponent("my account - JB Perks")}`)}),function(){return r2.apply(this,arguments)}),{skipBirthdayPrompt:B,isPerksFinished:L}=w2??{};return(0,p.useEffect)(()=>{let e3=new URL(window.location.href).searchParams;!_||C||$||B?$&&e3.get("source")==="Birthmonthemail"&&f2(e4=>(0,o._)((0,n._)({},e4),{birthMonthExists:!0})):x.push("/add-birthday")},[_,C,$,B]),(0,p.useEffect)(()=>{_&&L&&M?.queryStatus==="success"&&(g2!==y&&b(y),U(),(0,v._c)()||x.push("/"))},[_,L,M?.queryStatus]),(0,p.useEffect)(()=>{$&&_&&(S||E)&&f2(e3=>(0,o._)((0,n._)({},e3),{isPerksFinished:!0}))},[$,_,S,E]),(0,p.useEffect)(()=>{(M?.error||R)&&f2(e3=>(0,o._)((0,n._)({},e3),{isPerksFinished:!0}))},[M?.error,R]),(0,p.useEffect)(()=>{let e3=new URL(window.location.href).searchParams;f2(t3=>(0,o._)((0,n._)({},t3),{ignoreSkipVerifyPreference:!0,hideSkipVerifyButton:!0,receiptCode:e3.get("receiptCode"),receiptPhone:e3.get("phoneNumber"),source:e3.get("source"),storeId:e3.get("storeId")}))},[]),p.createElement(p.Fragment,null,e2)},g=({children:e2,isSitewide:t2})=>{let r2=new URL(window.location.href);return t2&&["/pages/perks","/account","/account/login"].includes(r2.pathname)?p.createElement(p.Fragment,null,e2):p.createElement(w,null,e2)}},89101:function(e,t,r){r.d(t,{I4:()=>u,QX:()=>s});var i=r(70879),n=r(27337),o=r(44194),l=r(69189);let a={loading:!0,isSuccess:void 0,fetchError:!1,isFinished:!1,currentMobileNumber:null,loginMobileVerifySkipped:!1,accountMobileVerifySkipped:!1,isJustVerified:!1},c=(0,o.createContext)(null),s=e2=>{let[t2,r2]=(0,o.useState)(a);return o.createElement(c.Provider,(0,i._)({value:{data:t2,setMobileVerifyData:e3=>{e3.refetch?(r2((0,i._)({},a)),(0,l._)({onSuccess:e4=>r2((0,n._)((0,i._)({},e4),{loading:!1,isSuccess:!0})),onError:e4=>r2((0,n._)((0,i._)({},e4),{loading:!1,isSuccess:!1,fetchError:!0}))})):r2((0,i._)({},t2,e3))}}},e2))},u=()=>{let e2=o.useContext(c);if(e2==null)throw Error("useMobileVerifyContext must be used within a MobileVerifyProvider");return e2}},69189:function(e,t,r){r.d(t,{Z:()=>d,_:()=>s});var i=r(41622),n=r(70879),o=r(27337),l=r(44194),a=r(89101);let c=new(r(32585)).Z;function s(e2){return u.apply(this,arguments)}function u(){return(u=(0,i._)(function*({onSuccess:e2,onError:t2}){try{var r2,i2,l2,a2;let s2=yield c.getCustomerData((i2=window)===null||i2===void 0||(r2=i2.Jbhifi)===null||r2===void 0?void 0:r2.shopifyCustomerId);s2.isSuccess?e2((0,o._)((0,n._)({},s2),{currentMobileNumber:s2.raw.data.phone,mongoCustomerId:s2.raw.data.customerId,loginMobileVerifySkipped:!!(!((l2=s2.raw.data.preferences)===null||l2===void 0)&&l2.shopify_login_skipMobileVerification),accountMobileVerifySkipped:!!(!((a2=s2.raw.data.preferences)===null||a2===void 0)&&a2.shopify_account_skipMobileVerification)})):t2({isSuccess:!1})}catch(e3){console.error(e3),t2({isSuccess:!1})}})).apply(this,arguments)}let d=(e2,t2=!0)=>{let{data:r2,setMobileVerifyData:c2}=(0,a.I4)(),u2=(0,l.useRef)(!1);return(0,l.useEffect)(()=>{if(!u2.current&&t2){var r3;u2.current=!0,c2({loading:!0,fetchError:!1}),s({onSuccess:(r3=(0,i._)(function*(t3){let r4=(0,o._)((0,n._)({},t3),{loading:!1,fetchError:!1,refetch:!1,mobileNumber:null});c2(r4),e2&&e2(r4)}),function(e3){return r3.apply(this,arguments)}),onError:t3=>{let r4=(0,o._)((0,n._)({},t3),{loading:!1,fetchError:!0});c2(r4),e2&&e2(r4)}})}},[t2,u2]),{data:r2,setMobileVerifyData:c2}}},93323:function(e,t,r){r.d(t,{tz:()=>E,wX:()=>b,D:()=>g,wT:()=>_});var i,n,o,l=r(44194);function a(){return(a=Object.assign?Object.assign.bind():function(e2){for(var t2=1;t2<arguments.length;t2++){var r2=arguments[t2];for(var i2 in r2)({}).hasOwnProperty.call(r2,i2)&&(e2[i2]=r2[i2])}return e2}).apply(null,arguments)}let c=function(e2){return l.createElement("svg",a({viewBox:"0 0 140 38",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e2),n||(n=l.createElement("path",{fill:"#000",d:"M0 .494h139.903v37.308H0z"})),o||(o=l.createElement("path",{d:"M11.022 31.535L9.189 8.337c2.378-.599 4.929-.877 7.652-.836 4.104.062 7.533.906 10.288 2.533 2.774 1.628 4.135 4.14 4.084 7.534-.038 2.48-.962 4.397-2.773 5.75-1.812 1.335-3.948 1.984-6.41 1.947-1.156-.018-2.217-.183-3.183-.496l1.255 5.896-9.08.87zm7.4-11.977c1.351-.503 2.451-1.102 3.301-1.798.85-.696 1.284-1.585 1.3-2.666.011-.746-.269-1.338-.84-1.776-.553-.456-1.259-.69-2.117-.704-.485-.007-.999.07-1.543.229l-.1 6.715zM36.43 29.568L35.08 7.888 48.7 6.414l.263 4.873-7.231.73.437 4.373 4.706-.265.448 3.7-3.546 1.29.31 1.684 6.387-.407.364 9.24-14.408-2.064zM55.259 32.762l-1.63-23.615c1.37-.539 2.999-.962 4.888-1.27a31.419 31.419 0 015.463-.42c2.014.03 3.699.288 5.053.775 1.374.469 2.212 1.162 2.515 2.081.304.919.449 1.816.435 2.693a6.397 6.397 0 01-.772 2.983c-.48.925-1.194 1.866-2.142 2.822l8.798 6.68-9.529 6.545-4.58-9.863-3.108 1.968.827 6.364-6.218 2.257zm6.212-14.794c1.143-.374 2.168-.9 3.074-1.576.905-.677 1.364-1.444 1.377-2.302a2.11 2.11 0 00-.21-.899c-.125-.337-.308-.573-.549-.708a1.38 1.38 0 00-.78-.235c-.578-.009-1.309.213-2.193.666-.864.435-1.57.788-2.114 1.06l1.395 3.994zM81.776 30.252l.83-21.647 9.722 1.154-2.33 9.703 7.177-8.287 8.055.29-9.377 9.429 9.597 9.38-10.941 1.85-5.43-7.303-2.305 8.025-4.998-2.594zM108.091 28.718l4.171-7.492c.769.963 1.913 1.754 3.434 2.374 1.521.601 2.98.912 4.379.934.97.014 1.737-.114 2.301-.386.563-.27.85-.696.858-1.274.02-1.268-.963-2.3-2.947-3.095a504.026 504.026 0 01-5.653-1.848c-2.096-.815-3.185-1.559-3.268-2.232-.065-.691-.095-1.167-.091-1.428.028-1.847 1.065-3.184 3.111-4.011 2.065-.846 4.32-1.343 6.767-1.493 2.465-.168 4.612-.294 6.442-.379l-.075 4.952a23.1 23.1 0 00-2.645-.879c-.892-.256-1.701-.39-2.429-.4-.727-.011-1.298.11-1.712.366-.396.255-.599.7-.608 1.334-.005.298 1.204.577 3.625.838 2.421.26 4.518 1 6.291 2.221 1.791 1.221 2.662 3.492 2.612 6.812-.045 2.928-1.32 5.26-3.828 6.994-2.489 1.735-5.374 2.577-8.657 2.528-2.742-.041-5.022-.365-6.841-.97-1.82-.606-3.565-1.761-5.237-3.466z",fill:"#fff"})))};var s=r(22776);let u=({children:e2})=>l.createElement(s.r,null,l.createElement("div",{className:"_5uh6zm0"},l.createElement(c,{"data-testid":"perks-logo"})),e2);var d=r(70879),p=r(27337),h=r(89101),f=r(11224),v=r(61021);let m="Finishing up...",y=({children:e2})=>{let{data:{isFinished:t2,isJustVerified:r2,isSuccess:i2}}=(0,h.I4)(),{setThemeContext:n2,setLoadingMessage:o2,loadingMessage:a2}=(0,f.ET)(),c2=()=>{let e3=new URLSearchParams;r2&&e3.append("alert","mobileVerified"),window.location.href=`${window.location.origin}/account#/${e3.toString()?`?${e3}`:""}`};return(0,l.useEffect)(()=>{i2&&a2!==m&&o2(m)},[i2]),(0,l.useEffect)(()=>{t2&&c2()},[t2,r2]),(0,l.useEffect)(()=>{let e3=()=>{var e4,t3,r3;let i3=new URLSearchParams((r3=(e4=window.location.href.split("?"))===null||e4===void 0?void 0:e4[1])!==null&&r3!==void 0?r3:"?");return i3.has("newUser")&&((t3=i3.get("loginMethod"))===null||t3===void 0?void 0:t3.toLowerCase())===v.M.email.toLowerCase()};n2(t3=>(0,p._)((0,d._)({},t3),{shouldSkipPhoneVerification:e3()}))},[]),l.createElement(l.Fragment,null,e2)};var w=r(34473),g=((i={}).default="default",i.perks="perks",i.perksSuccess="perksSuccess",i);let b=()=>{let e2=_(window.location.href),t2=window.location.href.includes("receipt")?w.FB.receipts:w.FB.account,r2=t2===w.FB.receipts?"eReceipts":"my account";return e2==="perks"&&(r2=`${r2} - JB Perks`),{category:r2,context:t2}},_=e2=>{var t2,r2;return!((t2=window.location.pathname)===null||t2===void 0)&&t2.startsWith("/pages/receipts")?"perks":(r2=g[new URL(e2).searchParams.get("pageTheme")])!==null&&r2!==void 0?r2:"default"},S=({children:e2})=>l.createElement(l.Fragment,null,e2),E=e2=>{switch(e2){case"perks":return u;case"perksSuccess":return S;default:return y}}},11224:function(e,t,r){r.d(t,{ET:()=>a,pN:()=>o});var i=r(44194),n=r(93323);let o=({children:e2,isBlankLayout:t2})=>{let r2=(0,i.useRef)((0,n.wT)(window.location.href)),[o2,a2]=(0,i.useState)("Logging you in..."),[c,s]=(0,i.useState)({}),u=(0,n.tz)(t2?n.D.perksSuccess:r2.current);return i.createElement(l.Provider,{value:{pageTheme:r2,loadingMessage:o2,setLoadingMessage:a2,themeContext:c,setThemeContext:s}},i.createElement(u,null,e2))},l=i.createContext(null),a=()=>{var e2;let t2={pageTheme:{current:n.D.default},loadingMessage:"",setLoadingMessage:()=>null,themeContext:{},setThemeContext:()=>null};return(e2=i.useContext(l))!==null&&e2!==void 0?e2:t2}},99907:function(e,t,r){r.d(t,{$:()=>i});let i=e2=>{var t2;let r2=(Array.isArray(e2)?e2:[e2]).map(e3=>`sass-opt-out-${e3}`);(t2=document.getElementsByTagName("html")[0])===null||t2===void 0||t2.classList.add(...r2)}},21016:function(e,t,r){r.d(t,{Z:()=>c});var i=r(41622),n=r(70879),o=r(84973),l=r(96226),a=r(34473);class c{validateStatus(e2){return e2>=200&&e2<500}getReceipt(e2){var t2=this;return(0,i._)(function*(){return yield(0,o.rd)(`${l.y.discoveryServiceUrl}${e2}`,{headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"}},t2.validateStatus)})()}sendReceiptVerification(e2){return(0,i._)(function*(){return yield(0,o.rd)(`${l.y.discoveryServiceUrl}${e2}/SendVerification`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"}})})()}verifyReceipt(e2,t2,r2){return(0,i._)(function*(){return yield(0,o.rd)(`${l.y.discoveryServiceUrl}${e2}`,{headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8","x-verification-code":t2,"x-verification-reference":r2}})})()}downloadReceipt(e2,t2){return(0,i._)(function*(){let r2={headers:{Accept:"application/pdf"}};t2&&(r2.headers["x-token-receipt"]=t2);try{let t3=yield fetch(`${l.y.discoveryServiceUrl}${e2}/Download`,r2);return t3.ok?yield t3.text():yield t3.json()}catch{return{ErrorCode:"FetchError"}}})()}redirectToAccount(e2,t2={}){let r2=new URLSearchParams((0,n._)({gtmCategory:"eReceipts",gtmContext:a.FB.receipts},t2));window.location.href=`${window.location.origin}/account#/instore/${e2}?${r2}`}}}}]);
//# sourceMappingURL=/cdn/shop/t/373/assets/bundle.e74a66f9c7757d94.js.map?v=171163454419611108241741914906
